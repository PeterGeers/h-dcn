# Cognito Roles Verification Report

**Date**: January 8, 2026  
**Purpose**: Verify which admin roles actually exist in the H-DCN Cognito User Pool

## Verification Method

Queried the actual Cognito User Pool (`eu-west-1_OAT3oPCIm`) using AWS CLI to get the definitive list of existing groups/roles.

## Findings

### ‚úÖ Admin Roles That Actually Exist

| Role Name                | Description                                     | Status    |
| ------------------------ | ----------------------------------------------- | --------- |
| `System_CRUD`            | Full system administration permissions          | ‚úÖ EXISTS |
| `System_User_Management` | System user management permissions              | ‚úÖ EXISTS |
| `System_Logs_Read`       | Permission to read system logs and audit trails | ‚úÖ EXISTS |

### ‚ùå Admin Roles Referenced in Code But Do NOT Exist

| Role Name         | Status            | Notes                                     |
| ----------------- | ----------------- | ----------------------------------------- |
| `hdcnAdmins`      | ‚ùå DOES NOT EXIST | Referenced in many auth_fallback.py files |
| `Webmaster`       | ‚ùå DOES NOT EXIST | Referenced in many handlers               |
| `System_CRUD_All` | ‚ùå DOES NOT EXIST | Legacy role, migrated to `System_CRUD`    |

### üìã Complete List of All Cognito Groups (25 total)

**Permission Roles:**

- `Members_CRUD` - Permission to create, read, update, delete member data
- `Members_Read` - Permission to read member data
- `Members_Export` - Export members data permissions
- `Members_Status_Approve` - Permission to approve member status changes
- `Events_CRUD` - Permission to create, read, update, delete event data
- `Events_Read` - Permission to read event data
- `Events_Export` - Export events data permissions
- `Products_CRUD` - Permission to create, read, update, delete product data
- `Products_Read` - Permission to read product data
- `Products_Export` - Export products data permissions
- `Communication_CRUD` - Full communication management permissions
- `Communication_Read` - Read communication data permissions
- `Communication_Export` - Export communication data permissions
- `System_CRUD` - Full system administration permissions
- `System_User_Management` - System user management permissions
- `System_Logs_Read` - Permission to read system logs and audit trails
- `Webshop_Management` - Webshop management permissions

**Region Roles:**

- `Regio_All` - Access to all regions
- `Regio_Noord-Holland` - Access to Noord-Holland region only
- `Regio_Zuid-Holland` - Access to Zuid-Holland region only
- `Regio_Friesland` - Access to Friesland region only
- `Regio_Utrecht` - Access to Utrecht region only
- `Regio_Oost` - Access to Oost region only
- `Regio_Limburg` - Access to Limburg region only
- `Regio_Groningen/Drenthe` - Access to Groningen/Drenthe region only
- `Regio_Brabant/Zeeland` - Access to Brabant/Zeeland region only
- `Regio_Duitsland` - Access to Duitsland region only

**Basic Roles:**

- `hdcnLeden` - Basic H-DCN member role - access to personal data and webshop

**Auto-Generated:**

- `eu-west-1_OAT3oPCIm_Google` - Autogenerated group for users who sign in using Google

## Impact on Code

### ‚úÖ Fixed in Validation Utilities

The validation utilities in `backend/shared/auth_utils.py` have been updated to use only roles that actually exist:

```python
# OLD (incorrect)
admin_roles = ['hdcnAdmins', 'System_CRUD_All', 'Webmaster', 'System_User_Management']

# NEW (correct)
admin_roles = ['System_CRUD', 'System_User_Management']
```

### ‚ö†Ô∏è Still Needs Fixing

Many files still reference non-existent roles and need to be updated:

**Files with `hdcnAdmins` references:**

- Multiple `auth_fallback.py` files
- Handler `app.py` files
- Role permission mappings

**Files with `Webmaster` references:**

- Multiple `auth_fallback.py` files
- Handler `app.py` files
- Permission checking logic

**Files with `System_CRUD_All` references:**

- Legacy role mappings
- Migration scripts
- Handler decorators

## Recommendations

1. **Update all auth_fallback.py files** to remove references to non-existent roles
2. **Update handler decorators** to use actual roles instead of non-existent ones
3. **Update role permission mappings** to reflect actual Cognito structure
4. **Add validation** to prevent referencing non-existent roles in the future
5. **Create migration script** to systematically update all references

## Verification Command

To verify roles exist in Cognito:

```bash
python -c "
import boto3
cognito = boto3.client('cognito-idp', region_name='eu-west-1')
response = cognito.list_groups(UserPoolId='eu-west-1_OAT3oPCIm')
for group in response['Groups']:
    print(f'{group[\"GroupName\"]}: {group.get(\"Description\", \"No description\")}')
"
```

This report ensures the validation utilities now use only roles that actually exist in the system.
