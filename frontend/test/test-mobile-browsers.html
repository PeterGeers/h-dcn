<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Browser WebAuthn Support Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 15px;
            background: #1a1a1a;
            color: #ffffff;
            font-size: 14px;
            line-height: 1.4;
        }
        .test-section {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #FF6B35;
        }
        .test-result {
            padding: 8px;
            margin: 8px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .pass { background: #1a4d3a; border-left: 4px solid #28a745; }
        .fail { background: #4d1a1a; border-left: 4px solid #dc3545; }
        .warning { background: #4d3a1a; border-left: 4px solid #ffc107; }
        .info { background: #1a3a4d; border-left: 4px solid #17a2b8; }
        button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px 4px;
            width: 100%;
            max-width: 300px;
            touch-action: manipulation;
        }
        button:hover { background: #e55a2b; }
        button:disabled { background: #666; cursor: not-allowed; }
        .browser-info {
            background: #333;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 12px;
        }
        .mobile-logo {
            font-size: 1.5em;
            margin-right: 8px;
        }
        .compatibility-matrix {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 11px;
        }
        .compatibility-matrix th,
        .compatibility-matrix td {
            border: 1px solid #555;
            padding: 6px 8px;
            text-align: left;
        }
        .compatibility-matrix th {
            background: #444;
            font-weight: bold;
        }
        .support-full { color: #28a745; font-weight: bold; }
        .support-partial { color: #ffc107; font-weight: bold; }
        .support-none { color: #dc3545; font-weight: bold; }
        pre {
            background: #222;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 10px;
        }
        .mobile-notes {
            background: #2a2a3a;
            border: 1px solid #FF6B35;
            border-radius: 6px;
            padding: 12px;
            margin: 12px 0;
            font-size: 12px;
        }
        .mobile-notes h4 {
            color: #FF6B35;
            margin-top: 0;
            font-size: 14px;
        }
        .platform-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin: 2px;
        }
        .ios-badge { background: #007AFF; color: white; }
        .android-badge { background: #3DDC84; color: black; }
        .other-badge { background: #666; color: white; }
        h1 { font-size: 20px; margin-bottom: 10px; }
        h2 { font-size: 16px; margin-bottom: 8px; }
        h3 { font-size: 14px; margin-bottom: 6px; }
        .button-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        @media (min-width: 480px) {
            .button-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <h1><span class="mobile-logo">üì±</span>Mobile Browser WebAuthn Test</h1>
    <p>This test validates WebAuthn/Passkey support on mobile browsers (iOS Safari, Chrome, Android Chrome, etc.)</p>

    <div class="mobile-notes">
        <h4>Mobile WebAuthn Requirements</h4>
        <ul>
            <li><strong>iOS:</strong> iOS 14+ required, all browsers use Safari engine</li>
            <li><strong>Android:</strong> Android 7+ recommended, Chrome 70+ or Samsung Internet 13+</li>
            <li><strong>Biometrics:</strong> Touch ID, Face ID, fingerprint, or face unlock</li>
            <li><strong>Security:</strong> HTTPS required for production use</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Mobile Platform Detection</h2>
        <div id="mobile-browser-info" class="browser-info">
            <p>Detecting mobile platform...</p>
        </div>
        <div class="button-grid">
            <button onclick="detectMobilePlatform()">Refresh Detection</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Mobile WebAuthn API Tests</h2>
        <div id="mobile-webauthn-results"></div>
        <div class="button-grid">
            <button onclick="runMobileWebAuthnTests()">Run WebAuthn Tests</button>
            <button onclick="testMobileBiometrics()">Test Biometrics</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Platform-Specific Tests</h2>
        <div id="platform-specific-results"></div>
        <div class="button-grid">
            <button onclick="testIOSFeatures()">Test iOS Features</button>
            <button onclick="testAndroidFeatures()">Test Android Features</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Mobile Passkey Registration</h2>
        <div id="mobile-passkey-results"></div>
        <div class="button-grid">
            <button onclick="testMobilePasskeyRegistration()">Test Passkey Registration</button>
            <button onclick="testCrossDeviceAuth()">Test Cross-Device Auth</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Mobile Compatibility Matrix</h2>
        <table class="compatibility-matrix">
            <thead>
                <tr>
                    <th>Platform</th>
                    <th>WebAuthn</th>
                    <th>Biometrics</th>
                    <th>Cross-Device</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="mobile-compatibility-matrix">
                <!-- Will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>Mobile Test Summary</h2>
        <div id="mobile-test-summary"></div>
        <div class="button-grid">
            <button onclick="generateMobileReport()">Generate Report</button>
            <button onclick="clearMobileResults()">Clear Results</button>
        </div>
    </div>

    <script>
        let mobileTestResults = [];
        let mobileBrowserInfo = {};

        function logMobileResult(testName, success, message, details = null) {
            const result = {
                testName,
                success,
                message,
                details,
                timestamp: new Date().toISOString()
            };
            mobileTestResults.push(result);
            
            const className = success === true ? 'pass' : success === false ? 'fail' : success === 'warning' ? 'warning' : 'info';
            const icon = success === true ? '‚úÖ' : success === false ? '‚ùå' : success === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            console.log(`${icon} ${testName}: ${message}`, details);
            return result;
        }

        function displayMobileResult(containerId, result) {
            const container = document.getElementById(containerId);
            const className = result.success === true ? 'pass' : result.success === false ? 'fail' : result.success === 'warning' ? 'warning' : 'info';
            const icon = result.success === true ? '‚úÖ' : result.success === false ? '‚ùå' : result.success === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            const div = document.createElement('div');
            div.className = `test-result ${className}`;
            div.innerHTML = `
                <strong>${icon} ${result.testName}</strong><br>
                ${result.message}
                ${result.details ? `<pre>${JSON.stringify(result.details, null, 2)}</pre>` : ''}
                <small>Time: ${new Date(result.timestamp).toLocaleTimeString()}</small>
            `;
            container.appendChild(div);
        }

        function detectMobilePlatform() {
            const userAgent = navigator.userAgent;
            
            // Detect mobile platform
            let platform = 'Unknown';
            let isMobile = false;
            let isTablet = false;
            let platformBadgeClass = 'other-badge';
            
            if (/iPhone/i.test(userAgent)) {
                platform = 'iOS (iPhone)';
                isMobile = true;
                platformBadgeClass = 'ios-badge';
            } else if (/iPad/i.test(userAgent)) {
                platform = 'iOS (iPad)';
                isTablet = true;
                isMobile = true;
                platformBadgeClass = 'ios-badge';
            } else if (/iPod/i.test(userAgent)) {
                platform = 'iOS (iPod)';
                isMobile = true;
                platformBadgeClass = 'ios-badge';
            } else if (/Android/i.test(userAgent)) {
                if (/Mobile/i.test(userAgent)) {
                    platform = 'Android (Phone)';
                    isMobile = true;
                } else {
                    platform = 'Android (Tablet)';
                    isTablet = true;
                    isMobile = true;
                }
                platformBadgeClass = 'android-badge';
            } else {
                const mobileIndicators = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
                isMobile = mobileIndicators.test(userAgent);
                if (isMobile) {
                    platform = 'Mobile (Other)';
                } else {
                    platform = 'Desktop';
                }
            }

            // Detect browser on mobile
            let browserName = 'Unknown';
            let browserVersion = 'Unknown';
            let isSupported = false;
            
            if (platform.includes('iOS')) {
                if (userAgent.includes('CriOS')) {
                    browserName = 'Chrome (iOS)';
                    const match = userAgent.match(/CriOS\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = true;
                } else if (userAgent.includes('FxiOS')) {
                    browserName = 'Firefox (iOS)';
                    const match = userAgent.match(/FxiOS\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = true;
                } else if (userAgent.includes('Safari')) {
                    browserName = 'Safari (iOS)';
                    const match = userAgent.match(/Version\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = parseInt(browserVersion) >= 14;
                }
            } else if (platform.includes('Android')) {
                if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
                    browserName = 'Chrome (Android)';
                    const match = userAgent.match(/Chrome\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = parseInt(browserVersion) >= 70;
                } else if (userAgent.includes('Firefox')) {
                    browserName = 'Firefox (Android)';
                    const match = userAgent.match(/Firefox\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = parseInt(browserVersion) >= 92;
                } else if (userAgent.includes('Samsung')) {
                    browserName = 'Samsung Internet';
                    const match = userAgent.match(/SamsungBrowser\/(\d+)/);
                    browserVersion = match ? match[1] : 'Unknown';
                    isSupported = parseInt(browserVersion) >= 13;
                }
            }

            // Detect OS version
            let osVersion = 'Unknown';
            if (platform.includes('iOS')) {
                const match = userAgent.match(/OS (\d+)_(\d+)/);
                if (match) {
                    osVersion = `${match[1]}.${match[2]}`;
                    if (parseInt(match[1]) < 14) {
                        isSupported = false;
                    }
                }
            } else if (platform.includes('Android')) {
                const match = userAgent.match(/Android (\d+)/);
                if (match) {
                    osVersion = match[1];
                    if (parseInt(match[1]) < 7) {
                        isSupported = false;
                    }
                }
            }

            mobileBrowserInfo = {
                browserName,
                browserVersion,
                platform,
                osVersion,
                isMobile,
                isTablet,
                isSupported,
                userAgent
            };

            const infoDiv = document.getElementById('mobile-browser-info');
            const statusClass = isMobile && isSupported ? 'support-full' : isMobile ? 'support-partial' : 'support-none';
            
            infoDiv.innerHTML = `
                <div class="platform-badge ${platformBadgeClass}">${platform}</div>
                <p><strong>Browser:</strong> ${browserName} ${browserVersion}</p>
                <p><strong>OS Version:</strong> ${osVersion}</p>
                <p><strong>Mobile Device:</strong> <span class="${isMobile ? 'support-full' : 'support-none'}">${isMobile ? 'Yes' : 'No'}</span></p>
                <p><strong>WebAuthn Supported:</strong> <span class="${statusClass}">${isSupported ? 'Yes' : 'No'}</span></p>
                <details>
                    <summary>User Agent</summary>
                    <code style="font-size: 9px; word-break: break-all;">${userAgent}</code>
                </details>
            `;

            const result = logMobileResult(
                'Mobile Platform Detection',
                isMobile && isSupported,
                `Detected ${browserName} ${browserVersion} on ${platform} (OS: ${osVersion}) - Mobile: ${isMobile}, Supported: ${isSupported}`,
                mobileBrowserInfo
            );

            if (!isMobile) {
                logMobileResult(
                    'Not Mobile Device',
                    'warning',
                    'This test is designed for mobile browsers. Please open on a mobile device for accurate results.'
                );
            }

            if (isMobile && !isSupported) {
                logMobileResult(
                    'Mobile Browser/OS Update Needed',
                    'warning',
                    'Mobile browser or OS version may not support WebAuthn. Update for best support.'
                );
            }
        }

        async function runMobileWebAuthnTests() {
            const container = document.getElementById('mobile-webauthn-results');
            container.innerHTML = '';

            // Test WebAuthn API availability
            const webAuthnSupported = !!(
                window.PublicKeyCredential &&
                navigator.credentials &&
                navigator.credentials.create &&
                navigator.credentials.get
            );

            const result1 = logMobileResult(
                'Mobile WebAuthn API Support',
                webAuthnSupported,
                webAuthnSupported ? 'WebAuthn API is available on mobile' : 'WebAuthn API is not available on mobile',
                { 
                    PublicKeyCredential: !!window.PublicKeyCredential,
                    navigatorCredentials: !!navigator.credentials,
                    platform: mobileBrowserInfo.platform,
                    browser: mobileBrowserInfo.browserName
                }
            );
            displayMobileResult('mobile-webauthn-results', result1);

            if (!webAuthnSupported) {
                const result2 = logMobileResult(
                    'Mobile WebAuthn Not Supported',
                    false,
                    'Cannot proceed with mobile WebAuthn tests - API not available'
                );
                displayMobileResult('mobile-webauthn-results', result2);
                return;
            }

            // Test secure context
            const isSecureContext = window.isSecureContext;
            const result2 = logMobileResult(
                'Mobile Secure Context (HTTPS)',
                isSecureContext,
                isSecureContext ? 'Running in secure context on mobile' : 'Not in secure context - mobile WebAuthn requires HTTPS',
                { isSecureContext, protocol: window.location.protocol }
            );
            displayMobileResult('mobile-webauthn-results', result2);

            // Mobile WebAuthn characteristics
            const result3 = logMobileResult(
                'Mobile WebAuthn Characteristics',
                'info',
                'Mobile WebAuthn has unique characteristics',
                {
                    characteristics: [
                        'Typically uses platform authenticators (biometrics)',
                        'May have different timeout behaviors',
                        'Cross-device authentication capabilities',
                        'Native biometric integration'
                    ]
                }
            );
            displayMobileResult('mobile-webauthn-results', result3);
        }

        async function testMobileBiometrics() {
            const container = document.getElementById('mobile-webauthn-results');

            if (!window.PublicKeyCredential) {
                const result = logMobileResult(
                    'Mobile Biometrics Test',
                    false,
                    'WebAuthn not supported - cannot test mobile biometrics'
                );
                displayMobileResult('mobile-webauthn-results', result);
                return;
            }

            try {
                const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                const result = logMobileResult(
                    'Mobile Biometric Availability',
                    available,
                    available ? 
                        'Mobile biometric authentication is available' : 
                        'Mobile biometric authentication is not available',
                    { available, platform: mobileBrowserInfo.platform }
                );
                displayMobileResult('mobile-webauthn-results', result);

                if (available) {
                    let biometricType = 'Biometric authentication';
                    if (mobileBrowserInfo.platform.includes('iOS')) {
                        biometricType = 'Touch ID or Face ID';
                    } else if (mobileBrowserInfo.platform.includes('Android')) {
                        biometricType = 'Fingerprint or face unlock';
                    }

                    const result2 = logMobileResult(
                        'Mobile Biometric Type',
                        true,
                        `${biometricType} should be available on this device`,
                        { type: biometricType, platform: mobileBrowserInfo.platform }
                    );
                    displayMobileResult('mobile-webauthn-results', result2);
                }

            } catch (error) {
                const result = logMobileResult(
                    'Mobile Biometrics Test Error',
                    false,
                    `Error testing mobile biometrics: ${error.message}`,
                    { error: error.name, message: error.message }
                );
                displayMobileResult('mobile-webauthn-results', result);
            }
        }

        async function testIOSFeatures() {
            const container = document.getElementById('platform-specific-results');
            container.innerHTML = '';

            if (!mobileBrowserInfo.platform.includes('iOS')) {
                const result = logMobileResult(
                    'iOS Features Test',
                    'warning',
                    'Not running on iOS - cannot test iOS-specific features',
                    { currentPlatform: mobileBrowserInfo.platform }
                );
                displayMobileResult('platform-specific-results', result);
                return;
            }

            const osVersion = parseFloat(mobileBrowserInfo.osVersion);
            
            const result1 = logMobileResult(
                'iOS WebAuthn Support',
                osVersion >= 14,
                osVersion >= 14 ? 
                    `iOS ${mobileBrowserInfo.osVersion} supports WebAuthn` :
                    `iOS ${mobileBrowserInfo.osVersion} does not support WebAuthn (requires iOS 14+)`,
                { osVersion: mobileBrowserInfo.osVersion, required: 14 }
            );
            displayMobileResult('platform-specific-results', result1);

            // iOS browser engine note
            const result2 = logMobileResult(
                'iOS Browser Engine',
                'info',
                'All iOS browsers use Safari WebKit engine for WebAuthn',
                {
                    note: 'Chrome, Firefox, and other browsers on iOS use Safari engine',
                    implication: 'WebAuthn support depends on iOS version, not browser version'
                }
            );
            displayMobileResult('platform-specific-results', result2);

            if (osVersion >= 15) {
                const result3 = logMobileResult(
                    'iOS 15+ Enhanced Features',
                    true,
                    'iOS 15+ has enhanced WebAuthn features',
                    {
                        enhancements: [
                            'iCloud Keychain passkey sync',
                            'Improved cross-device flows',
                            'Better Safari integration'
                        ]
                    }
                );
                displayMobileResult('platform-specific-results', result3);
            }
        }

        async function testAndroidFeatures() {
            const container = document.getElementById('platform-specific-results');
            
            if (!mobileBrowserInfo.platform.includes('Android')) {
                const result = logMobileResult(
                    'Android Features Test',
                    'warning',
                    'Not running on Android - cannot test Android-specific features',
                    { currentPlatform: mobileBrowserInfo.platform }
                );
                displayMobileResult('platform-specific-results', result);
                return;
            }

            const osVersion = parseInt(mobileBrowserInfo.osVersion);
            
            const result1 = logMobileResult(
                'Android WebAuthn Support',
                osVersion >= 7,
                osVersion >= 7 ? 
                    `Android ${mobileBrowserInfo.osVersion} supports WebAuthn` :
                    `Android ${mobileBrowserInfo.osVersion} may not support WebAuthn (Android 7+ recommended)`,
                { osVersion: mobileBrowserInfo.osVersion, recommended: 7 }
            );
            displayMobileResult('platform-specific-results', result1);

            // Android browser variations
            if (mobileBrowserInfo.browserName.includes('Chrome')) {
                const chromeVersion = parseInt(mobileBrowserInfo.browserVersion);
                const result2 = logMobileResult(
                    'Android Chrome WebAuthn',
                    chromeVersion >= 70,
                    chromeVersion >= 70 ? 
                        `Chrome ${mobileBrowserInfo.browserVersion} on Android has WebAuthn support` :
                        `Chrome ${mobileBrowserInfo.browserVersion} on Android may have limited WebAuthn support`,
                    { chromeVersion, required: 70 }
                );
                displayMobileResult('platform-specific-results', result2);
            }

            if (osVersion >= 9) {
                const result3 = logMobileResult(
                    'Android 9+ Enhanced Features',
                    true,
                    'Android 9+ has enhanced biometric authentication',
                    {
                        enhancements: [
                            'BiometricPrompt API',
                            'Improved fingerprint handling',
                            'Better hardware security'
                        ]
                    }
                );
                displayMobileResult('platform-specific-results', result3);
            }
        }

        async function testMobilePasskeyRegistration() {
            const container = document.getElementById('mobile-passkey-results');
            container.innerHTML = '';

            if (!window.PublicKeyCredential) {
                const result = logMobileResult(
                    'Mobile Passkey Registration Test',
                    false,
                    'WebAuthn not supported - cannot test mobile passkey registration'
                );
                displayMobileResult('mobile-passkey-results', result);
                return;
            }

            try {
                // Create mobile-optimized registration options
                const challenge = new Uint8Array(32);
                crypto.getRandomValues(challenge);
                
                const userId = new TextEncoder().encode('mobile-test@example.com');
                
                const publicKeyCredentialCreationOptions = {
                    challenge: challenge,
                    rp: {
                        name: "H-DCN Mobile Test",
                        id: window.location.hostname,
                    },
                    user: {
                        id: userId,
                        name: "mobile-test@example.com",
                        displayName: "Mobile Test User",
                    },
                    pubKeyCredParams: [
                        { alg: -7, type: "public-key" },
                        { alg: -257, type: "public-key" }
                    ],
                    authenticatorSelection: {
                        authenticatorAttachment: "platform",
                        userVerification: "preferred",
                        requireResidentKey: false
                    },
                    timeout: 120000, // Longer timeout for mobile
                    attestation: "none"
                };

                const result1 = logMobileResult(
                    'Mobile Passkey Registration Options',
                    true,
                    'Successfully created mobile-optimized passkey registration options',
                    { 
                        challenge: challenge.length,
                        rp: publicKeyCredentialCreationOptions.rp.name,
                        timeout: publicKeyCredentialCreationOptions.timeout,
                        platform: mobileBrowserInfo.platform
                    }
                );
                displayMobileResult('mobile-passkey-results', result1);

                const result2 = logMobileResult(
                    'Mobile Registration Considerations',
                    'info',
                    'Mobile passkey registration has specific considerations',
                    {
                        considerations: [
                            'User may need to unlock device first',
                            'Biometric prompt will be native to platform',
                            'Registration may take longer than desktop',
                            'Extended timeout for user interaction'
                        ]
                    }
                );
                displayMobileResult('mobile-passkey-results', result2);

            } catch (error) {
                const result = logMobileResult(
                    'Mobile Passkey Registration Error',
                    false,
                    `Error setting up mobile passkey registration: ${error.message}`,
                    { error: error.name, message: error.message }
                );
                displayMobileResult('mobile-passkey-results', result);
            }
        }

        async function testCrossDeviceAuth() {
            const container = document.getElementById('mobile-passkey-results');

            const result = logMobileResult(
                'Mobile Cross-Device Authentication',
                true,
                'Mobile devices can participate in cross-device authentication flows',
                {
                    capabilities: [
                        'Can authenticate for desktop sessions',
                        'QR code scanning for cross-device auth',
                        'Bluetooth proximity authentication',
                        'Platform authenticator sharing'
                    ]
                }
            );
            displayMobileResult('mobile-passkey-results', result);
        }

        function updateMobileCompatibilityMatrix() {
            const matrix = document.getElementById('mobile-compatibility-matrix');
            
            const platforms = [
                {
                    name: 'iOS 14+ (Safari)',
                    webauthn: 'Full',
                    biometrics: 'Touch/Face ID',
                    crossDevice: 'Full',
                    status: mobileBrowserInfo.platform?.includes('iOS') && mobileBrowserInfo.browserName?.includes('Safari') ? 'current' : 'other'
                },
                {
                    name: 'iOS 14+ (Chrome)',
                    webauthn: 'Full',
                    biometrics: 'Touch/Face ID',
                    crossDevice: 'Full',
                    status: mobileBrowserInfo.platform?.includes('iOS') && mobileBrowserInfo.browserName?.includes('Chrome') ? 'current' : 'other'
                },
                {
                    name: 'Android 7+ (Chrome 70+)',
                    webauthn: 'Full',
                    biometrics: 'Fingerprint/Face',
                    crossDevice: 'Full',
                    status: mobileBrowserInfo.platform?.includes('Android') && mobileBrowserInfo.browserName?.includes('Chrome') ? 'current' : 'other'
                },
                {
                    name: 'Android 7+ (Samsung 13+)',
                    webauthn: 'Full',
                    biometrics: 'Fingerprint/Face',
                    crossDevice: 'Partial',
                    status: mobileBrowserInfo.browserName?.includes('Samsung') ? 'current' : 'other'
                },
                {
                    name: 'Android 7+ (Firefox 92+)',
                    webauthn: 'Partial',
                    biometrics: 'Limited',
                    crossDevice: 'Limited',
                    status: mobileBrowserInfo.platform?.includes('Android') && mobileBrowserInfo.browserName?.includes('Firefox') ? 'current' : 'other'
                }
            ];

            matrix.innerHTML = platforms.map(platform => `
                <tr style="${platform.status === 'current' ? 'background: #2a4a2a;' : ''}">
                    <td>${platform.name} ${platform.status === 'current' ? '(Current)' : ''}</td>
                    <td class="support-${platform.webauthn === 'Full' ? 'full' : platform.webauthn === 'Partial' ? 'partial' : 'none'}">${platform.webauthn}</td>
                    <td class="support-full">${platform.biometrics}</td>
                    <td class="support-${platform.crossDevice === 'Full' ? 'full' : platform.crossDevice === 'Partial' ? 'partial' : 'none'}">${platform.crossDevice}</td>
                    <td class="support-${platform.status === 'current' ? 'full' : 'partial'}">${platform.status === 'current' ? 'CURRENT' : 'OTHER'}</td>
                </tr>
            `).join('');
        }

        function generateMobileReport() {
            const summary = document.getElementById('mobile-test-summary');
            
            const totalTests = mobileTestResults.length;
            const passedTests = mobileTestResults.filter(r => r.success === true).length;
            const failedTests = mobileTestResults.filter(r => r.success === false).length;
            const warningTests = mobileTestResults.filter(r => r.success === 'warning').length;
            
            const isMobile = mobileBrowserInfo.isMobile;
            const hasWebAuthn = window.PublicKeyCredential;
            const platform = mobileBrowserInfo.platform;
            const browser = mobileBrowserInfo.browserName;
            
            let overallStatus = 'Unknown';
            let statusClass = 'info';
            
            if (isMobile) {
                if (hasWebAuthn && mobileBrowserInfo.isSupported) {
                    overallStatus = 'Excellent Mobile Support';
                    statusClass = 'pass';
                } else if (hasWebAuthn) {
                    overallStatus = 'Partial Mobile Support';
                    statusClass = 'warning';
                } else {
                    overallStatus = 'Mobile Update Required';
                    statusClass = 'fail';
                }
            } else {
                overallStatus = 'Not Mobile Device';
                statusClass = 'warning';
            }

            summary.innerHTML = `
                <div class="test-result ${statusClass}">
                    <h3>üì± Mobile Browser Compatibility Report</h3>
                    <p><strong>Overall Status:</strong> ${overallStatus}</p>
                    <p><strong>Platform:</strong> ${platform}</p>
                    <p><strong>Browser:</strong> ${browser} ${mobileBrowserInfo.browserVersion}</p>
                    <p><strong>OS Version:</strong> ${mobileBrowserInfo.osVersion}</p>
                    <p><strong>Tests Run:</strong> ${totalTests}</p>
                    <p><strong>Passed:</strong> ${passedTests} | <strong>Failed:</strong> ${failedTests} | <strong>Warnings:</strong> ${warningTests}</p>
                    <p><strong>WebAuthn Support:</strong> ${hasWebAuthn ? 'Yes' : 'No'}</p>
                    <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;
        }

        function clearMobileResults() {
            mobileTestResults = [];
            document.getElementById('mobile-webauthn-results').innerHTML = '';
            document.getElementById('platform-specific-results').innerHTML = '';
            document.getElementById('mobile-passkey-results').innerHTML = '';
            document.getElementById('mobile-test-summary').innerHTML = '';
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            detectMobilePlatform();
            updateMobileCompatibilityMatrix();
        });
    </script>
</body>
</html>